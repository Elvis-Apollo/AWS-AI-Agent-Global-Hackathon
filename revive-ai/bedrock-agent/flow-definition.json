{
  "name": "ChurnAnalysisFlow",
  "description": "Multi-source intelligence gathering flow for customer churn analysis with parallel data collection",
  "definition": {
    "nodes": [
      {
        "name": "InputNode",
        "type": "Input",
        "outputs": [
          {
            "name": "customer_id",
            "type": "String"
          },
          {
            "name": "company_name",
            "type": "String"
          },
          {
            "name": "mrr",
            "type": "Number"
          },
          {
            "name": "subscription_tier",
            "type": "String"
          },
          {
            "name": "churn_date",
            "type": "String"
          },
          {
            "name": "cancellation_reason",
            "type": "String"
          }
        ]
      },
      {
        "name": "CalculateCLV",
        "type": "LambdaFunction",
        "configuration": {
          "lambdaArn": "arn:aws:lambda:us-east-1:292101577831:function:bedrock-agent-executor"
        },
        "inputs": [
          {
            "expression": "$.data.mrr",
            "name": "mrr",
            "type": "Number"
          },
          {
            "expression": "$.data.subscription_tier",
            "name": "subscription_tier",
            "type": "String"
          }
        ],
        "outputs": [
          {
            "name": "clv",
            "type": "Number"
          },
          {
            "name": "priority",
            "type": "String"
          }
        ]
      },
      {
        "name": "GetCRMHistory",
        "type": "LambdaFunction",
        "configuration": {
          "lambdaArn": "arn:aws:lambda:us-east-1:292101577831:function:bedrock-agent-executor"
        },
        "inputs": [
          {
            "expression": "$.data.customer_id",
            "name": "customer_id",
            "type": "String"
          }
        ],
        "outputs": [
          {
            "name": "crm_data",
            "type": "Object"
          }
        ]
      },
      {
        "name": "SearchCompanyInfo",
        "type": "LambdaFunction",
        "configuration": {
          "lambdaArn": "arn:aws:lambda:us-east-1:292101577831:function:bedrock-agent-executor"
        },
        "inputs": [
          {
            "expression": "$.data.company_name",
            "name": "company_name",
            "type": "String"
          }
        ],
        "outputs": [
          {
            "name": "company_data",
            "type": "Object"
          }
        ]
      },
      {
        "name": "CheckProductRoadmap",
        "type": "LambdaFunction",
        "configuration": {
          "lambdaArn": "arn:aws:lambda:us-east-1:292101577831:function:bedrock-agent-executor"
        },
        "inputs": [
          {
            "expression": "$.data.cancellation_reason",
            "name": "churn_reason",
            "type": "String"
          }
        ],
        "outputs": [
          {
            "name": "roadmap_data",
            "type": "Object"
          }
        ]
      },
      {
        "name": "ChurnAnalyzerAgent",
        "type": "Agent",
        "configuration": {
          "agentAliasArn": "arn:aws:bedrock:us-east-1:292101577831:agent-alias/HAKDC7PY1Z/WN63LBEVKR"
        },
        "inputs": [
          {
            "expression": "$.data",
            "name": "customer_data",
            "type": "Object"
          },
          {
            "expression": "$.data.clv",
            "name": "clv_data",
            "type": "Object"
          },
          {
            "expression": "$.data.crm_data",
            "name": "crm_intelligence",
            "type": "Object"
          },
          {
            "expression": "$.data.company_data",
            "name": "company_intelligence",
            "type": "Object"
          },
          {
            "expression": "$.data.roadmap_data",
            "name": "roadmap_intelligence",
            "type": "Object"
          }
        ],
        "outputs": [
          {
            "name": "analysis",
            "type": "Object"
          }
        ]
      },
      {
        "name": "CampaignGeneratorAgent",
        "type": "Agent",
        "configuration": {
          "agentAliasArn": "arn:aws:bedrock:us-east-1:292101577831:agent-alias/HXMON0RCRP/YO7A6XFPXU"
        },
        "inputs": [
          {
            "expression": "$.data",
            "name": "customer_data",
            "type": "Object"
          },
          {
            "expression": "$.data.analysis",
            "name": "churn_analysis",
            "type": "Object"
          }
        ],
        "outputs": [
          {
            "name": "campaign",
            "type": "Object"
          }
        ]
      },
      {
        "name": "OutputNode",
        "type": "Output",
        "inputs": [
          {
            "expression": "$.data.analysis",
            "name": "churn_analysis",
            "type": "Object"
          },
          {
            "expression": "$.data.campaign",
            "name": "campaign_strategy",
            "type": "Object"
          },
          {
            "expression": "$.data.clv",
            "name": "customer_value",
            "type": "Object"
          },
          {
            "expression": "$.data.crm_data",
            "name": "crm_intelligence",
            "type": "Object"
          },
          {
            "expression": "$.data.company_data",
            "name": "company_intelligence",
            "type": "Object"
          },
          {
            "expression": "$.data.roadmap_data",
            "name": "roadmap_intelligence",
            "type": "Object"
          }
        ]
      }
    ],
    "connections": [
      {
        "name": "InputToCalculateCLV",
        "source": "InputNode",
        "target": "CalculateCLV",
        "type": "Data"
      },
      {
        "name": "InputToGetCRM",
        "source": "InputNode",
        "target": "GetCRMHistory",
        "type": "Data"
      },
      {
        "name": "InputToSearchCompany",
        "source": "InputNode",
        "target": "SearchCompanyInfo",
        "type": "Data"
      },
      {
        "name": "InputToCheckRoadmap",
        "source": "InputNode",
        "target": "CheckProductRoadmap",
        "type": "Data"
      },
      {
        "name": "AllDataToChurnAnalyzer",
        "source": "CalculateCLV",
        "target": "ChurnAnalyzerAgent",
        "type": "Data",
        "condition": {
          "and": [
            {"source": "CalculateCLV", "type": "Completed"},
            {"source": "GetCRMHistory", "type": "Completed"},
            {"source": "SearchCompanyInfo", "type": "Completed"},
            {"source": "CheckProductRoadmap", "type": "Completed"}
          ]
        }
      },
      {
        "name": "AnalysisToCampaign",
        "source": "ChurnAnalyzerAgent",
        "target": "CampaignGeneratorAgent",
        "type": "Data"
      },
      {
        "name": "CampaignToOutput",
        "source": "CampaignGeneratorAgent",
        "target": "OutputNode",
        "type": "Data"
      }
    ]
  }
}
